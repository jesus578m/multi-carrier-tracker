<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
    <title>Rastreador Multi-Paquetería</title>
    <style>
      :root { color-scheme: light dark; }
      body { font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; margin: 0; padding: 24px; max-width: 1000px; }
      h1 { margin: 0 0 16px; font-size: 42px; }
      .card { border: 1px solid rgba(0,0,0,.1); border-radius: 12px; padding: 16px; margin: 12px 0; }
      .row { display: grid; grid-template-columns: 180px 1fr; gap: 12px; align-items: center; margin: 8px 0; }
      input, select, button { padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(0,0,0,.2); font-size: 15px; }
      button { cursor: pointer; }
      .result { white-space: normal; }
      .muted { opacity: .7; font-size: 12px; }
      .kv { margin: 6px 0; }
      .kv span { display: inline-block; min-width: 180px; font-weight: 600; }
      .flex { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
      a.button { text-decoration: none; display: inline-block; }
    </style>
  </head>
  <body>
    <h1>Rastreador Multi-Paquetería</h1>
    <div class="card">
      <div class="row">
        <label>Paquetería</label>
        <select id="carrier">
          <option value="dhl">DHL</option>
          <option value="fedex" selected>FedEx</option>
          <option value="ups">UPS</option>
          <option value="delta">Delta Cargo</option>
          <option value="expeditors">Expeditors</option>
        </select>
      </div>
      <div class="row">
        <label>Número/Guía</label>
        <input id="code" placeholder="Ingresa tu guía o AWB" />
      </div>
      <div class="row">
        <label></label>
        <button id="btn">Consultar</button>
      </div>
      <div id="out" class="result"></div>
    </div>

    <p class="muted">
      * Se usa información pública de las páginas oficiales. Si no es posible extraer la información automáticamente, se incluye el enlace oficial como respaldo.
    </p>

    <script>
      const $ = (s) => document.querySelector(s);

      function addLine(frag, k, v) {
        if (!v) return;
        const div = document.createElement("div");
        div.className = "kv";
        div.innerHTML = `<span>${k}:</span> ${v}`;
        frag.appendChild(div);
      }

      $("#btn").addEventListener("click", async () => {
        const carrier = $("#carrier").value.trim();
        const code = $("#code").value.trim();
        const out = $("#out");
        out.textContent = "Consultando...";

        try {
          const url = `/api/track?carrier=${encodeURIComponent(carrier)}&code=${encodeURIComponent(code)}`;
          const r = await fetch(url);
          const json = await r.json();
          if (!json.ok) {
            out.textContent = "Error: " + (json.error || "desconocido");
            return;
          }

          const frag = document.createDocumentFragment();
          addLine(frag, "Paquetería", json.carrier?.toUpperCase());
          addLine(frag, "Guía", json.code);
          addLine(frag, "Estado", json.status);
          addLine(frag, "Entrega estimada", json.eta);
          addLine(frag, "Entregado el", json.deliveredAt);
          addLine(frag, "Firmado por", json.signedBy);
          addLine(frag, "Origen", json.origin);
          addLine(frag, "Destino", json.destination);

          const divBtn = document.createElement("div");
          divBtn.className = "flex";
          const a = document.createElement("a");
          a.href = json.officialUrl;
          a.target = "_blank";
          a.rel = "noopener";
          a.className = "button";
          a.innerHTML = "<button>Abrir página oficial</button>";
          divBtn.appendChild(a);

          out.innerHTML = "";
          out.appendChild(frag);
          if (!json.status && !json.eta && !json.deliveredAt) {
            out.appendChild(divBtn);
          }
        } catch {
          out.textContent = "Falló la consulta. Intenta de nuevo.";
        }
      });
    </script>
  </body>
</html>

